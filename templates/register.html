{% extends "base.html" %}

{% block content %}
<style>
  :root{
    *, *::before, *::after { box-sizing: border-box; }
    .input { width: 100%; max-width: 100%; box-sizing: border-box; }
    --bg:#0b1020;--card:#121932;--muted:#9aa3b2;--text:#e7ecf3;
    --primary:#6c7cff;--primary-600:#5768ff;--accent:#22d3ee;
    --ring:0 0 0 3px rgba(108,124,255,.25);--radius:16px;
    --shadow-lg:0 16px 40px rgba(0,0,0,.35);--shadow-md:0 12px 24px rgba(16,24,40,.25)
  }
  @media (prefers-color-scheme:light){
    :root{
      --bg:#f6f7fb;--card:#ffffff;--muted:#64748b;--text:#0f172a;
      --primary:#4f46e5;--primary-600:#4338ca;--accent:#0891b2;
      --ring:0 0 0 4px rgba(79,70,229,.18);
      --shadow-lg:0 24px 48px rgba(2,6,23,.15);--shadow-md:0 12px 24px rgba(2,6,23,.1)
    }
  }
  body{background:var(--bg)}
  .wrap{max-width:460px;margin:6vh auto;padding:0 20px;color:var(--text)}
  .hero{border-radius:calc(var(--radius) + 6px);
        background:linear-gradient(135deg,var(--primary),var(--accent));
        color:#fff; padding:22px; text-align:center; box-shadow:var(--shadow-lg)}
  .hero h2{margin:0;font-size:26px}
  .hero p{margin:6px 0 0;opacity:.9}

  .card{background:var(--card);border-radius:var(--radius);
        box-shadow:var(--shadow-md);padding:22px;margin-top:16px}

  .field{display:grid;gap:6px;margin:10px 0}
  .label{font-weight:600}
  .input{
    border:1px solid rgba(148,163,184,.28);background:rgba(255,255,255,.04);
    color:var(--text);border-radius:12px;padding:12px 14px;font:inherit;width:100%;
    transition:border-color .15s ease, box-shadow .15s ease, background .2s ease
  }
  .input:focus{outline:none;border-color:var(--primary);box-shadow:var(--ring);
               background:rgba(255,255,255,.06)}

  .pw-wrap{position:relative}
  .pw-toggle{
    position:absolute;right:10px;top:50%;transform:translateY(-50%);
    background:transparent;border:0;color:var(--muted);cursor:pointer;
    font-size:12px;font-weight:700;letter-spacing:.02em
  }

  .btn{appearance:none;border:0;border-radius:12px;padding:12px 14px;
       font-weight:700;cursor:pointer;width:100%;margin-top:6px;
       transition:transform .02s ease, background .2s ease, box-shadow .2s ease}
  .btn:active{transform:translateY(1px)}
  .btn-p{background:var(--primary);color:#fff;box-shadow:0 10px 24px rgba(79,70,229,.35)}
  .btn-p:hover{background:var(--primary-600)}

  .row{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
  .link{color:var(--primary);text-decoration:none;font-weight:600}
  .link:hover{text-decoration:underline}
  .muted{color:var(--muted)}

  .flash{
    margin-top:12px;border:1px solid rgba(239,68,68,.35);
    color:#fecaca;background:rgba(239,68,68,.08);
    padding:10px 12px;border-radius:12px;font-size:14px
  }
</style>

<div class="wrap" aria-labelledby="register-title">
  <div class="hero">
    <h2 id="register-title">Create your account</h2>
  </div>

  <div class="card">
    {% with msgs = get_flashed_messages() %}
      {% if msgs %}
        {% for m in msgs %}
          <div class="flash" role="alert">{{ m }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="post" id="register-form" autocomplete="on">
      <div class="field">
        <label class="label" for="username">Username</label>
        <input class="input" id="username" name="username" required
               autocomplete="username" autofocus placeholder="yourname">
      </div>

      <div class="field">
        <label class="label" for="password">Password</label>
        <div class="pw-wrap">
          <input class="input" id="password" type="password" name="password" required
                 autocomplete="new-password" placeholder="••••••••">
          <button type="button" class="pw-toggle" aria-label="Show password" id="pw-toggle">SHOW</button>
        </div>
      </div>


      <button type="submit" class="btn btn-p" id="submit-btn">Register</button>

      <div class="row">
        <span class="muted">Already have an account?</span>
        <a class="link" href="{{ url_for('auth.login') }}">Login here →</a>
      </div>
    </form>
  </div>
</div>

<script>
(function(){
  const form = document.getElementById('register-form');
  const submit = document.getElementById('submit-btn');
  const pw = document.getElementById('password');
  const confirm = document.getElementById('confirm');
  const hint = document.getElementById('match-hint');

  // show/hide toggles
  document.querySelectorAll('.pw-toggle').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const targetId = btn.dataset.target || 'password';
      const input = document.getElementById(targetId);
      const isPwd = input.type === 'password';
      input.type = isPwd ? 'text' : 'password';
      btn.textContent = isPwd ? 'HIDE' : 'SHOW';
      btn.setAttribute('aria-label', isPwd ? 'Hide password' : 'Show password');
    });
  });

 
  function checkMatch(){
    const a = pw.value.trim(), b = confirm.value.trim();
    if(!b){ hint.textContent=''; return true; }
    const ok = a === b;
    hint.textContent = ok ? 'Passwords match.' : 'Passwords do not match.';
    hint.style.color = ok ? '#22c55e' : '#fca5a5';
    return ok;
  }
  pw.addEventListener('input', checkMatch);
  confirm.addEventListener('input', checkMatch);

  form?.addEventListener('submit', (e)=>{
    submit.disabled = true;
    submit.style.opacity = .85;
    submit.textContent = 'Creating…';
    if(!checkMatch()){ 
    }
  });
})();
</script>
{% endblock %}
